<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- Copyright 2021 Google LLC</span><span>
</span><span id="line-2"></span><span class="hs-comment">--</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- you may not use this file except in compliance with the License.</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- You may obtain a copy of the License at</span><span>
</span><span id="line-6"></span><span class="hs-comment">--</span><span>
</span><span id="line-7"></span><span class="hs-comment">--      http://www.apache.org/licenses/LICENSE-2.0</span><span>
</span><span id="line-8"></span><span class="hs-comment">--</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- Unless required by applicable law or agreed to in writing, software</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- See the License for the specific language governing permissions and</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- limitations under the License.</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-comment">{-|
This module defines a set of Haskell types wrapping references to native C++
MLIR objects along with some basic operations on them. See the submodules for
more specialized components such as an 'MLIR.Native.ExecutionEngine.ExecutionEngine'
or 'MLIR.Native.Pass.PassManager'.
-}</span><span>
</span><span id="line-21"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">MLIR.Native</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Contexts</span></span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="MLIR.Native.FFI.html#Context"><span class="hs-identifier">Context</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="MLIR.Native.html#createContext"><span class="hs-identifier">createContext</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><a href="MLIR.Native.html#destroyContext"><span class="hs-identifier">destroyContext</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><a href="MLIR.Native.html#withContext"><span class="hs-identifier">withContext</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><a href="MLIR.Native.html#HasContext"><span class="hs-identifier">HasContext</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Dialect registration</span></span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><a href="MLIR.Native.html#registerAllDialects"><span class="hs-identifier">registerAllDialects</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><a href="MLIR.Native.html#getNumLoadedDialects"><span class="hs-identifier">getNumLoadedDialects</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Type</span></span><span>
</span><span id="line-32"></span><span>    </span><span class="annot"><a href="MLIR.Native.FFI.html#Type"><span class="hs-identifier">Type</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Location</span></span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><a href="MLIR.Native.FFI.html#Location"><span class="hs-identifier">Location</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><a href="MLIR.Native.html#getFileLineColLocation"><span class="hs-identifier">getFileLineColLocation</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><a href="MLIR.Native.html#getNameLocation"><span class="hs-identifier">getNameLocation</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>    </span><span class="annot"><a href="MLIR.Native.html#getUnknownLocation"><span class="hs-identifier">getUnknownLocation</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Operation</span></span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><a href="MLIR.Native.FFI.html#Operation"><span class="hs-identifier">Operation</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>    </span><span class="annot"><a href="MLIR.Native.html#getOperationName"><span class="hs-identifier">getOperationName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>    </span><span class="annot"><a href="MLIR.Native.html#showOperation"><span class="hs-identifier">showOperation</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>    </span><span class="annot"><a href="MLIR.Native.html#showOperationWithLocation"><span class="hs-identifier">showOperationWithLocation</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>    </span><span class="annot"><a href="MLIR.Native.html#verifyOperation"><span class="hs-identifier">verifyOperation</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Region</span></span><span>
</span><span id="line-45"></span><span>    </span><span class="annot"><a href="MLIR.Native.FFI.html#Region"><span class="hs-identifier">Region</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>    </span><span class="annot"><a href="MLIR.Native.html#getOperationRegions"><span class="hs-identifier">getOperationRegions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>    </span><span class="annot"><a href="MLIR.Native.html#getRegionBlocks"><span class="hs-identifier">getRegionBlocks</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Block</span></span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><a href="MLIR.Native.FFI.html#Block"><span class="hs-identifier">Block</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>    </span><span class="annot"><a href="MLIR.Native.html#showBlock"><span class="hs-identifier">showBlock</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>    </span><span class="annot"><a href="MLIR.Native.html#getBlockOperations"><span class="hs-identifier">getBlockOperations</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Module</span></span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><a href="MLIR.Native.FFI.html#Module"><span class="hs-identifier">Module</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>    </span><span class="annot"><a href="MLIR.Native.html#createEmptyModule"><span class="hs-identifier">createEmptyModule</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><a href="MLIR.Native.html#parseModule"><span class="hs-identifier">parseModule</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>    </span><span class="annot"><a href="MLIR.Native.html#destroyModule"><span class="hs-identifier">destroyModule</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>    </span><span class="annot"><a href="MLIR.Native.html#getModuleBody"><span class="hs-identifier">getModuleBody</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>    </span><span class="annot"><a href="MLIR.Native.html#moduleAsOperation"><span class="hs-identifier">moduleAsOperation</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>    </span><span class="annot"><a href="MLIR.Native.html#moduleFromOperation"><span class="hs-identifier">moduleFromOperation</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>    </span><span class="annot"><a href="MLIR.Native.html#showModule"><span class="hs-identifier">showModule</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>    </span><span class="annot"><span class="hs-comment">-- * StringRef</span></span><span>
</span><span id="line-62"></span><span>    </span><span class="annot"><a href="MLIR.Native.html#StringRef"><span class="hs-identifier">StringRef</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>    </span><span class="annot"><a href="MLIR.Native.html#withStringRef"><span class="hs-identifier">withStringRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Identifier</span></span><span>
</span><span id="line-65"></span><span>    </span><span class="annot"><a href="MLIR.Native.FFI.html#Identifier"><span class="hs-identifier">Identifier</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>    </span><span class="annot"><a href="MLIR.Native.html#createIdentifier"><span class="hs-identifier">createIdentifier</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>    </span><span class="annot"><a href="MLIR.Native.html#identifierString"><span class="hs-identifier">identifierString</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>    </span><span class="annot"><span class="hs-comment">-- * LogicalResult</span></span><span>
</span><span id="line-69"></span><span>    </span><span class="annot"><a href="MLIR.Native.FFI.html#LogicalResult"><span class="hs-identifier">LogicalResult</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Failure"><span class="hs-identifier">Failure</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>    </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Success"><span class="hs-identifier">Success</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Debugging utilities</span></span><span>
</span><span id="line-73"></span><span>    </span><span class="annot"><a href="MLIR.Native.html#setDebugMode"><span class="hs-identifier">setDebugMode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>    </span><span class="annot"><a href="MLIR.Native.html#HasDump"><span class="hs-identifier">HasDump</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Foreign.Ptr</span></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Foreign.Storable</span></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Foreign.Marshal.Alloc</span></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Foreign.Marshal.Array</span></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Language.C.Inline</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.IO.Class</span></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Cont</span></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">bracket</span></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html"><span class="hs-identifier">MLIR.Native.FFI</span></a></span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span class="hs-identifier">C.context</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">C.baseCtx</span><span> </span><span class="hs-operator">&lt;&gt;</span><span> </span><span class="hs-identifier">mlirCtx</span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-identifier">C.include</span><span> </span><span class="hs-string">&quot;mlir-c/Support.h&quot;</span><span>
</span><span id="line-95"></span><span class="hs-identifier">C.include</span><span> </span><span class="hs-string">&quot;mlir-c/Debug.h&quot;</span><span>
</span><span id="line-96"></span><span class="hs-identifier">C.include</span><span> </span><span class="hs-string">&quot;mlir-c/IR.h&quot;</span><span>
</span><span id="line-97"></span><span class="hs-identifier">C.include</span><span> </span><span class="hs-string">&quot;mlir-c/Pass.h&quot;</span><span>
</span><span id="line-98"></span><span class="hs-identifier">C.include</span><span> </span><span class="hs-string">&quot;mlir-c/Conversion.h&quot;</span><span>
</span><span id="line-99"></span><span class="hs-identifier">C.include</span><span> </span><span class="hs-string">&quot;mlir-c/RegisterEverything.h&quot;</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="hs-identifier">C.verbatim</span><span> </span><span class="hs-identifier">stringCallbackDecl</span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span class="hs-comment">-- TODO(apaszke): Flesh this out based on the header</span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-106"></span><span class="hs-comment">-- Context management</span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="hs-comment">-- | Creates a native MLIR context.</span><span>
</span><span id="line-109"></span><span class="annot"><a href="MLIR.Native.html#createContext"><span class="hs-identifier hs-type">createContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span>
</span><span id="line-110"></span><span id="createContext"><span class="annot"><span class="annottext">createContext :: IO Context
</span><a href="MLIR.Native.html#createContext"><span class="hs-identifier hs-var hs-var">createContext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.exp| MlirContext { mlirContextCreate() } |]</span></span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span class="hs-comment">-- | Destroys a native MLIR context.</span><span>
</span><span id="line-113"></span><span class="annot"><a href="MLIR.Native.html#destroyContext"><span class="hs-identifier hs-type">destroyContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span id="destroyContext"><span class="annot"><span class="annottext">destroyContext :: Context -&gt; IO ()
</span><a href="MLIR.Native.html#destroyContext"><span class="hs-identifier hs-var hs-var">destroyContext</span></a></span></span><span> </span><span id="local-6989586621679450518"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679450518"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.exp| void { mlirContextDestroy($(MlirContext ctx)) } |]</span></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="hs-comment">-- | Wraps an IO action that gets access to a fresh MLIR context.</span><span>
</span><span id="line-117"></span><span id="local-6989586621679450516"><span class="annot"><a href="MLIR.Native.html#withContext"><span class="hs-identifier hs-type">withContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MLIR.Native.FFI.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679450516"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679450516"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-118"></span><span id="withContext"><span class="annot"><span class="annottext">withContext :: (Context -&gt; IO a) -&gt; IO a
</span><a href="MLIR.Native.html#withContext"><span class="hs-identifier hs-var hs-var">withContext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO Context -&gt; (Context -&gt; IO ()) -&gt; (Context -&gt; IO a) -&gt; IO a
forall a b c. IO a -&gt; (a -&gt; IO b) -&gt; (a -&gt; IO c) -&gt; IO c
</span><span class="hs-identifier hs-var">bracket</span></span><span> </span><span class="annot"><span class="annottext">IO Context
</span><a href="MLIR.Native.html#createContext"><span class="hs-identifier hs-var">createContext</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; IO ()
</span><a href="MLIR.Native.html#destroyContext"><span class="hs-identifier hs-var">destroyContext</span></a></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="hs-comment">-- TODO(apaszke): Can this be pure?</span><span>
</span><span id="line-121"></span><span class="hs-comment">-- | A typeclass for retrieving MLIR contexts managing other native types.</span><span>
</span><span id="line-122"></span><span class="hs-keyword">class</span><span> </span><span id="HasContext"><span class="annot"><a href="MLIR.Native.html#HasContext"><span class="hs-identifier hs-var">HasContext</span></a></span></span><span> </span><span id="local-6989586621679450588"><span class="annot"><a href="#local-6989586621679450588"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-123"></span><span>  </span><span class="hs-comment">-- | Retrieve the MLIR context that manages the storage of the native value.</span><span>
</span><span id="line-124"></span><span>  </span><span id="getContext"><span class="annot"><a href="MLIR.Native.html#getContext"><span class="hs-identifier hs-type">getContext</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679450588"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-127"></span><span class="hs-comment">-- Dialect registration</span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="hs-comment">-- | Register all builtin MLIR dialects in the specified 'Context'.</span><span>
</span><span id="line-130"></span><span class="annot"><a href="MLIR.Native.html#registerAllDialects"><span class="hs-identifier hs-type">registerAllDialects</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span id="registerAllDialects"><span class="annot"><span class="annottext">registerAllDialects :: Context -&gt; IO ()
</span><a href="MLIR.Native.html#registerAllDialects"><span class="hs-identifier hs-var hs-var">registerAllDialects</span></a></span></span><span> </span><span id="local-6989586621679450514"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679450514"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.block| void {
    MlirDialectRegistry registry = mlirDialectRegistryCreate();
    mlirRegisterAllDialects(registry);
    mlirContextAppendDialectRegistry($(MlirContext ctx), registry);
    mlirDialectRegistryDestroy(registry);
    mlirContextLoadAllAvailableDialects($(MlirContext ctx));
  } |]</span></span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span class="hs-comment">-- | Retrieve the count of dialects currently registered in the 'Context'.</span><span>
</span><span id="line-140"></span><span class="annot"><a href="MLIR.Native.html#getNumLoadedDialects"><span class="hs-identifier hs-type">getNumLoadedDialects</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-141"></span><span id="getNumLoadedDialects"><span class="annot"><span class="annottext">getNumLoadedDialects :: Context -&gt; IO Int
</span><a href="MLIR.Native.html#getNumLoadedDialects"><span class="hs-identifier hs-var hs-var">getNumLoadedDialects</span></a></span></span><span> </span><span id="local-6989586621679450512"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679450512"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CIntPtr -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(CIntPtr -&gt; Int) -&gt; IO CIntPtr -&gt; IO Int
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span>
</span><span id="line-142"></span><span>  </span><span class="annot"><span class="">[C.exp| intptr_t { mlirContextGetNumLoadedDialects($(MlirContext ctx)) } |]</span></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-145"></span><span class="hs-comment">-- Locations</span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span class="hs-comment">-- | Create an unknown source location.</span><span>
</span><span id="line-148"></span><span class="annot"><a href="MLIR.Native.html#getUnknownLocation"><span class="hs-identifier hs-type">getUnknownLocation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Location"><span class="hs-identifier hs-type">Location</span></a></span><span>
</span><span id="line-149"></span><span id="getUnknownLocation"><span class="annot"><span class="annottext">getUnknownLocation :: Context -&gt; IO Location
</span><a href="MLIR.Native.html#getUnknownLocation"><span class="hs-identifier hs-var hs-var">getUnknownLocation</span></a></span></span><span> </span><span id="local-6989586621679450509"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679450509"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-150"></span><span>  </span><span class="annot"><span class="">[C.exp| MlirLocation { mlirLocationUnknownGet($(MlirContext ctx)) } |]</span></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="annot"><a href="MLIR.Native.html#getFileLineColLocation"><span class="hs-identifier hs-type">getFileLineColLocation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="MLIR.Native.html#StringRef"><span class="hs-identifier hs-type">StringRef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.CUInt</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.CUInt</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Location"><span class="hs-identifier hs-type">Location</span></a></span><span>
</span><span id="line-153"></span><span id="getFileLineColLocation"><span class="annot"><span class="annottext">getFileLineColLocation :: Context -&gt; StringRef -&gt; CUInt -&gt; CUInt -&gt; IO Location
</span><a href="MLIR.Native.html#getFileLineColLocation"><span class="hs-identifier hs-var hs-var">getFileLineColLocation</span></a></span></span><span> </span><span id="local-6989586621679450507"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679450507"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MLIR.Native.html#StringRef"><span class="hs-identifier hs-type">StringRef</span></a></span><span> </span><span id="local-6989586621679450505"><span class="annot"><span class="annottext">Ptr CChar
</span><a href="#local-6989586621679450505"><span class="hs-identifier hs-var">sPtr</span></a></span></span><span> </span><span id="local-6989586621679450504"><span class="annot"><span class="annottext">CSize
</span><a href="#local-6989586621679450504"><span class="hs-identifier hs-var">len</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679450503"><span class="annot"><span class="annottext">CUInt
</span><a href="#local-6989586621679450503"><span class="hs-identifier hs-var">line</span></a></span></span><span> </span><span id="local-6989586621679450502"><span class="annot"><span class="annottext">CUInt
</span><a href="#local-6989586621679450502"><span class="hs-identifier hs-var">col</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span>
</span><span id="line-154"></span><span>  </span><span class="annot"><span class="">[C.exp| MlirLocation {
    mlirLocationFileLineColGet(
      $(MlirContext ctx),
      (MlirStringRef){$(char* sPtr), $(size_t len)},
      $(unsigned int line),
      $(unsigned int col)) } |]</span></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span class="annot"><a href="MLIR.Native.html#getNameLocation"><span class="hs-identifier hs-type">getNameLocation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="MLIR.Native.html#StringRef"><span class="hs-identifier hs-type">StringRef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Location"><span class="hs-identifier hs-type">Location</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Location"><span class="hs-identifier hs-type">Location</span></a></span><span>
</span><span id="line-162"></span><span id="getNameLocation"><span class="annot"><span class="annottext">getNameLocation :: Context -&gt; StringRef -&gt; Location -&gt; IO Location
</span><a href="MLIR.Native.html#getNameLocation"><span class="hs-identifier hs-var hs-var">getNameLocation</span></a></span></span><span> </span><span id="local-6989586621679450500"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679450500"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MLIR.Native.html#StringRef"><span class="hs-identifier hs-type">StringRef</span></a></span><span> </span><span id="local-6989586621679450499"><span class="annot"><span class="annottext">Ptr CChar
</span><a href="#local-6989586621679450499"><span class="hs-identifier hs-var">sPtr</span></a></span></span><span> </span><span id="local-6989586621679450498"><span class="annot"><span class="annottext">CSize
</span><a href="#local-6989586621679450498"><span class="hs-identifier hs-var">len</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679450497"><span class="annot"><span class="annottext">Location
</span><a href="#local-6989586621679450497"><span class="hs-identifier hs-var">childLoc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-163"></span><span>  </span><span class="annot"><span class="">[C.exp| MlirLocation {
    mlirLocationNameGet(
      $(MlirContext ctx),
      (MlirStringRef){$(char* sPtr), $(size_t len)},
      $(MlirLocation childLoc)) } |]</span></span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span class="hs-comment">-- TODO(apaszke): No destructor for locations?</span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-172"></span><span class="hs-comment">-- Operation</span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span class="hs-comment">-- | Retrieve the name of the given operation.</span><span>
</span><span id="line-175"></span><span class="annot"><a href="MLIR.Native.html#getOperationName"><span class="hs-identifier hs-type">getOperationName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Operation"><span class="hs-identifier hs-type">Operation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span>
</span><span id="line-176"></span><span id="getOperationName"><span class="annot"><span class="annottext">getOperationName :: Operation -&gt; IO Identifier
</span><a href="MLIR.Native.html#getOperationName"><span class="hs-identifier hs-var hs-var">getOperationName</span></a></span></span><span> </span><span id="local-6989586621679450495"><span class="annot"><span class="annottext">Operation
</span><a href="#local-6989586621679450495"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-177"></span><span>  </span><span class="annot"><span class="">[C.exp| MlirIdentifier { mlirOperationGetName($(MlirOperation op)) } |]</span></span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span class="hs-comment">-- | Show the operation using the MLIR printer.</span><span>
</span><span id="line-180"></span><span class="annot"><a href="MLIR.Native.html#showOperation"><span class="hs-identifier hs-type">showOperation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Operation"><span class="hs-identifier hs-type">Operation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">BS.ByteString</span></span><span>
</span><span id="line-181"></span><span id="showOperation"><span class="annot"><span class="annottext">showOperation :: Operation -&gt; IO ByteString
</span><a href="MLIR.Native.html#showOperation"><span class="hs-identifier hs-var hs-var">showOperation</span></a></span></span><span> </span><span id="local-6989586621679450493"><span class="annot"><span class="annottext">Operation
</span><a href="#local-6989586621679450493"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Ptr () -&gt; IO ()) -&gt; IO ByteString
</span><a href="MLIR.Native.html#showSomething"><span class="hs-identifier hs-var">showSomething</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679450491"><span class="annot"><span class="annottext">Ptr ()
</span><a href="#local-6989586621679450491"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-182"></span><span>  </span><span class="annot"><span class="">[C.block| void {
    MlirOpPrintingFlags flags = mlirOpPrintingFlagsCreate();
    mlirOperationPrintWithFlags($(MlirOperation op), flags,
                                HaskellMlirStringCallback, $(void* ctx));
    mlirOpPrintingFlagsDestroy(flags);
  } |]</span></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="hs-comment">-- TODO(jpienaar): This should probably be more general options supported.</span><span>
</span><span id="line-190"></span><span class="hs-comment">-- | Show the operation with location using the MLIR printer.</span><span>
</span><span id="line-191"></span><span class="annot"><a href="MLIR.Native.html#showOperationWithLocation"><span class="hs-identifier hs-type">showOperationWithLocation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Operation"><span class="hs-identifier hs-type">Operation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">BS.ByteString</span></span><span>
</span><span id="line-192"></span><span id="showOperationWithLocation"><span class="annot"><span class="annottext">showOperationWithLocation :: Operation -&gt; IO ByteString
</span><a href="MLIR.Native.html#showOperationWithLocation"><span class="hs-identifier hs-var hs-var">showOperationWithLocation</span></a></span></span><span> </span><span id="local-6989586621679450489"><span class="annot"><span class="annottext">Operation
</span><a href="#local-6989586621679450489"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Ptr () -&gt; IO ()) -&gt; IO ByteString
</span><a href="MLIR.Native.html#showSomething"><span class="hs-identifier hs-var">showSomething</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679450488"><span class="annot"><span class="annottext">Ptr ()
</span><a href="#local-6989586621679450488"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-193"></span><span>  </span><span class="annot"><span class="">[C.block| void {
    MlirOpPrintingFlags flags = mlirOpPrintingFlagsCreate();
    mlirOpPrintingFlagsEnableDebugInfo(flags, /*enable=*/true, /*prettyForm=*/false);
    mlirOperationPrintWithFlags($(MlirOperation op), flags,
                                HaskellMlirStringCallback, $(void* ctx));
    mlirOpPrintingFlagsDestroy(flags);
  } |]</span></span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span class="hs-comment">-- | Check validity of the operation.</span><span>
</span><span id="line-202"></span><span class="annot"><a href="MLIR.Native.html#verifyOperation"><span class="hs-identifier hs-type">verifyOperation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Operation"><span class="hs-identifier hs-type">Operation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-203"></span><span id="verifyOperation"><span class="annot"><span class="annottext">verifyOperation :: Operation -&gt; IO Bool
</span><a href="MLIR.Native.html#verifyOperation"><span class="hs-identifier hs-var hs-var">verifyOperation</span></a></span></span><span> </span><span id="local-6989586621679450486"><span class="annot"><span class="annottext">Operation
</span><a href="#local-6989586621679450486"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-204"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CBool
</span><span class="hs-number">1</span></span><span class="annot"><span class="annottext">CBool -&gt; CBool -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CBool -&gt; Bool) -&gt; IO CBool -&gt; IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="">[C.exp| bool { mlirOperationVerify($(MlirOperation op)) } |]</span></span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-207"></span><span class="hs-comment">-- Region</span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span class="hs-comment">-- | Returns the first Region in a Operation.</span><span>
</span><span id="line-210"></span><span class="annot"><a href="MLIR.Native.html#getOperationFirstRegion"><span class="hs-identifier hs-type">getOperationFirstRegion</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Operation"><span class="hs-identifier hs-type">Operation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Region"><span class="hs-identifier hs-type">Region</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span id="getOperationFirstRegion"><span class="annot"><span class="annottext">getOperationFirstRegion :: Operation -&gt; IO (Maybe Region)
</span><a href="MLIR.Native.html#getOperationFirstRegion"><span class="hs-identifier hs-var hs-var">getOperationFirstRegion</span></a></span></span><span> </span><span id="local-6989586621679450483"><span class="annot"><span class="annottext">Operation
</span><a href="#local-6989586621679450483"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Region -&gt; Maybe Region
forall a. Coercible a (Ptr ()) =&gt; a -&gt; Maybe a
</span><a href="MLIR.Native.FFI.html#nullable"><span class="hs-identifier hs-var">nullable</span></a></span><span> </span><span class="annot"><span class="annottext">(Region -&gt; Maybe Region) -&gt; IO Region -&gt; IO (Maybe Region)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="">[C.exp| MlirRegion {
    mlirOperationGetFirstRegion($(MlirOperation op))
  } |]</span></span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span class="hs-comment">-- | Returns the next Block in a Region.</span><span>
</span><span id="line-216"></span><span class="annot"><a href="MLIR.Native.html#getOperationNextRegion"><span class="hs-identifier hs-type">getOperationNextRegion</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Region"><span class="hs-identifier hs-type">Region</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Region"><span class="hs-identifier hs-type">Region</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span id="getOperationNextRegion"><span class="annot"><span class="annottext">getOperationNextRegion :: Region -&gt; IO (Maybe Region)
</span><a href="MLIR.Native.html#getOperationNextRegion"><span class="hs-identifier hs-var hs-var">getOperationNextRegion</span></a></span></span><span> </span><span id="local-6989586621679450479"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621679450479"><span class="hs-identifier hs-var">region</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Region -&gt; Maybe Region
forall a. Coercible a (Ptr ()) =&gt; a -&gt; Maybe a
</span><a href="MLIR.Native.FFI.html#nullable"><span class="hs-identifier hs-var">nullable</span></a></span><span> </span><span class="annot"><span class="annottext">(Region -&gt; Maybe Region) -&gt; IO Region -&gt; IO (Maybe Region)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="">[C.exp| MlirRegion {
    mlirRegionGetNextInOperation($(MlirRegion region))
  } |]</span></span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span class="hs-comment">-- | Returns the regions of an Operation.</span><span>
</span><span id="line-222"></span><span class="annot"><a href="MLIR.Native.html#getOperationRegions"><span class="hs-identifier hs-type">getOperationRegions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Operation"><span class="hs-identifier hs-type">Operation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="MLIR.Native.FFI.html#Region"><span class="hs-identifier hs-type">Region</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-223"></span><span id="getOperationRegions"><span class="annot"><span class="annottext">getOperationRegions :: Operation -&gt; IO [Region]
</span><a href="MLIR.Native.html#getOperationRegions"><span class="hs-identifier hs-var hs-var">getOperationRegions</span></a></span></span><span> </span><span id="local-6989586621679450477"><span class="annot"><span class="annottext">Operation
</span><a href="#local-6989586621679450477"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Region -&gt; IO (Maybe Region)) -&gt; IO (Maybe Region) -&gt; IO [Region]
forall a. (a -&gt; IO (Maybe a)) -&gt; IO (Maybe a) -&gt; IO [a]
</span><a href="MLIR.Native.html#unrollIOMaybe"><span class="hs-identifier hs-var">unrollIOMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Region -&gt; IO (Maybe Region)
</span><a href="MLIR.Native.html#getOperationNextRegion"><span class="hs-identifier hs-var">getOperationNextRegion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operation -&gt; IO (Maybe Region)
</span><a href="MLIR.Native.html#getOperationFirstRegion"><span class="hs-identifier hs-var">getOperationFirstRegion</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="#local-6989586621679450477"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span class="hs-comment">-- | Returns the first Block in a Region.</span><span>
</span><span id="line-226"></span><span class="annot"><a href="MLIR.Native.html#getRegionFirstBlock"><span class="hs-identifier hs-type">getRegionFirstBlock</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Region"><span class="hs-identifier hs-type">Region</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span id="getRegionFirstBlock"><span class="annot"><span class="annottext">getRegionFirstBlock :: Region -&gt; IO (Maybe Block)
</span><a href="MLIR.Native.html#getRegionFirstBlock"><span class="hs-identifier hs-var hs-var">getRegionFirstBlock</span></a></span></span><span> </span><span id="local-6989586621679450474"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621679450474"><span class="hs-identifier hs-var">region</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Block -&gt; Maybe Block
forall a. Coercible a (Ptr ()) =&gt; a -&gt; Maybe a
</span><a href="MLIR.Native.FFI.html#nullable"><span class="hs-identifier hs-var">nullable</span></a></span><span> </span><span class="annot"><span class="annottext">(Block -&gt; Maybe Block) -&gt; IO Block -&gt; IO (Maybe Block)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="">[C.exp| MlirBlock {
    mlirRegionGetFirstBlock($(MlirRegion region))
  } |]</span></span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span class="hs-comment">-- | Returns the next Block in a Region.</span><span>
</span><span id="line-232"></span><span class="annot"><a href="MLIR.Native.html#getRegionNextBlock"><span class="hs-identifier hs-type">getRegionNextBlock</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span id="getRegionNextBlock"><span class="annot"><span class="annottext">getRegionNextBlock :: Block -&gt; IO (Maybe Block)
</span><a href="MLIR.Native.html#getRegionNextBlock"><span class="hs-identifier hs-var hs-var">getRegionNextBlock</span></a></span></span><span> </span><span id="local-6989586621679450471"><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621679450471"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Block -&gt; Maybe Block
forall a. Coercible a (Ptr ()) =&gt; a -&gt; Maybe a
</span><a href="MLIR.Native.FFI.html#nullable"><span class="hs-identifier hs-var">nullable</span></a></span><span> </span><span class="annot"><span class="annottext">(Block -&gt; Maybe Block) -&gt; IO Block -&gt; IO (Maybe Block)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="">[C.exp| MlirBlock {
    mlirBlockGetNextInRegion($(MlirBlock block))
  } |]</span></span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span class="hs-comment">-- | Returns the Blocks in a Region.</span><span>
</span><span id="line-238"></span><span class="annot"><a href="MLIR.Native.html#getRegionBlocks"><span class="hs-identifier hs-type">getRegionBlocks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Region"><span class="hs-identifier hs-type">Region</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="MLIR.Native.FFI.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-239"></span><span id="getRegionBlocks"><span class="annot"><span class="annottext">getRegionBlocks :: Region -&gt; IO [Block]
</span><a href="MLIR.Native.html#getRegionBlocks"><span class="hs-identifier hs-var hs-var">getRegionBlocks</span></a></span></span><span> </span><span id="local-6989586621679450469"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621679450469"><span class="hs-identifier hs-var">region</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Block -&gt; IO (Maybe Block)) -&gt; IO (Maybe Block) -&gt; IO [Block]
forall a. (a -&gt; IO (Maybe a)) -&gt; IO (Maybe a) -&gt; IO [a]
</span><a href="MLIR.Native.html#unrollIOMaybe"><span class="hs-identifier hs-var">unrollIOMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Block -&gt; IO (Maybe Block)
</span><a href="MLIR.Native.html#getRegionNextBlock"><span class="hs-identifier hs-var">getRegionNextBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Region -&gt; IO (Maybe Block)
</span><a href="MLIR.Native.html#getRegionFirstBlock"><span class="hs-identifier hs-var">getRegionFirstBlock</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621679450469"><span class="hs-identifier hs-var">region</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-242"></span><span class="hs-comment">-- Block</span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span class="hs-comment">-- | Show the block using the MLIR printer.</span><span>
</span><span id="line-245"></span><span class="annot"><a href="MLIR.Native.html#showBlock"><span class="hs-identifier hs-type">showBlock</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">BS.ByteString</span></span><span>
</span><span id="line-246"></span><span id="showBlock"><span class="annot"><span class="annottext">showBlock :: Block -&gt; IO ByteString
</span><a href="MLIR.Native.html#showBlock"><span class="hs-identifier hs-var hs-var">showBlock</span></a></span></span><span> </span><span id="local-6989586621679450468"><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621679450468"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Ptr () -&gt; IO ()) -&gt; IO ByteString
</span><a href="MLIR.Native.html#showSomething"><span class="hs-identifier hs-var">showSomething</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679450467"><span class="annot"><span class="annottext">Ptr ()
</span><a href="#local-6989586621679450467"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="">[C.exp| void {
    mlirBlockPrint($(MlirBlock block), HaskellMlirStringCallback, $(void* ctx))
  } |]</span></span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span class="hs-comment">-- | Returns the first operation in a block.</span><span>
</span><span id="line-251"></span><span class="annot"><a href="MLIR.Native.html#getFirstOperationBlock"><span class="hs-identifier hs-type">getFirstOperationBlock</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Operation"><span class="hs-identifier hs-type">Operation</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span id="getFirstOperationBlock"><span class="annot"><span class="annottext">getFirstOperationBlock :: Block -&gt; IO (Maybe Operation)
</span><a href="MLIR.Native.html#getFirstOperationBlock"><span class="hs-identifier hs-var hs-var">getFirstOperationBlock</span></a></span></span><span> </span><span id="local-6989586621679450464"><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621679450464"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Operation -&gt; Maybe Operation
forall a. Coercible a (Ptr ()) =&gt; a -&gt; Maybe a
</span><a href="MLIR.Native.FFI.html#nullable"><span class="hs-identifier hs-var">nullable</span></a></span><span> </span><span class="annot"><span class="annottext">(Operation -&gt; Maybe Operation)
-&gt; IO Operation -&gt; IO (Maybe Operation)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span>
</span><span id="line-253"></span><span>  </span><span class="annot"><span class="">[C.exp| MlirOperation { mlirBlockGetFirstOperation($(MlirBlock block)) } |]</span></span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span class="hs-comment">-- | Returns the next operation in the block. Returns 'Nothing' if last</span><span>
</span><span id="line-256"></span><span class="hs-comment">-- operation in block.</span><span>
</span><span id="line-257"></span><span class="annot"><a href="MLIR.Native.html#getNextOperationBlock"><span class="hs-identifier hs-type">getNextOperationBlock</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Operation"><span class="hs-identifier hs-type">Operation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Operation"><span class="hs-identifier hs-type">Operation</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span id="getNextOperationBlock"><span class="annot"><span class="annottext">getNextOperationBlock :: Operation -&gt; IO (Maybe Operation)
</span><a href="MLIR.Native.html#getNextOperationBlock"><span class="hs-identifier hs-var hs-var">getNextOperationBlock</span></a></span></span><span> </span><span id="local-6989586621679450461"><span class="annot"><span class="annottext">Operation
</span><a href="#local-6989586621679450461"><span class="hs-identifier hs-var">childOp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Operation -&gt; Maybe Operation
forall a. Coercible a (Ptr ()) =&gt; a -&gt; Maybe a
</span><a href="MLIR.Native.FFI.html#nullable"><span class="hs-identifier hs-var">nullable</span></a></span><span> </span><span class="annot"><span class="annottext">(Operation -&gt; Maybe Operation)
-&gt; IO Operation -&gt; IO (Maybe Operation)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="">[C.exp| MlirOperation {
  mlirOperationGetNextInBlock($(MlirOperation childOp)) } |]</span></span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span class="hs-comment">-- | Returns the Operations in a Block.</span><span>
</span><span id="line-262"></span><span class="annot"><a href="MLIR.Native.html#getBlockOperations"><span class="hs-identifier hs-type">getBlockOperations</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="MLIR.Native.FFI.html#Operation"><span class="hs-identifier hs-type">Operation</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-263"></span><span id="getBlockOperations"><span class="annot"><span class="annottext">getBlockOperations :: Block -&gt; IO [Operation]
</span><a href="MLIR.Native.html#getBlockOperations"><span class="hs-identifier hs-var hs-var">getBlockOperations</span></a></span></span><span> </span><span id="local-6989586621679450459"><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621679450459"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Operation -&gt; IO (Maybe Operation))
-&gt; IO (Maybe Operation) -&gt; IO [Operation]
forall a. (a -&gt; IO (Maybe a)) -&gt; IO (Maybe a) -&gt; IO [a]
</span><a href="MLIR.Native.html#unrollIOMaybe"><span class="hs-identifier hs-var">unrollIOMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Operation -&gt; IO (Maybe Operation)
</span><a href="MLIR.Native.html#getNextOperationBlock"><span class="hs-identifier hs-var">getNextOperationBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Block -&gt; IO (Maybe Operation)
</span><a href="MLIR.Native.html#getFirstOperationBlock"><span class="hs-identifier hs-var">getFirstOperationBlock</span></a></span><span> </span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621679450459"><span class="hs-identifier hs-var">block</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-266"></span><span class="hs-comment">-- Module</span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="MLIR.Native.html#HasContext"><span class="hs-identifier hs-type">HasContext</span></a></span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-269"></span><span>  </span><span id="local-6989586621679450456"><span class="annot"><span class="annottext">getContext :: Module -&gt; IO Context
</span><a href="#local-6989586621679450456"><span class="hs-identifier hs-var hs-var hs-var hs-var">getContext</span></a></span></span><span> </span><span id="local-6989586621679450455"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621679450455"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.exp| MlirContext { mlirModuleGetContext($(MlirModule m)) } |]</span></span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span class="hs-comment">-- | Create an empty module.</span><span>
</span><span id="line-272"></span><span class="annot"><a href="MLIR.Native.html#createEmptyModule"><span class="hs-identifier hs-type">createEmptyModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Location"><span class="hs-identifier hs-type">Location</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-273"></span><span id="createEmptyModule"><span class="annot"><span class="annottext">createEmptyModule :: Location -&gt; IO Module
</span><a href="MLIR.Native.html#createEmptyModule"><span class="hs-identifier hs-var hs-var">createEmptyModule</span></a></span></span><span> </span><span id="local-6989586621679450453"><span class="annot"><span class="annottext">Location
</span><a href="#local-6989586621679450453"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-274"></span><span>  </span><span class="annot"><span class="">[C.exp| MlirModule { mlirModuleCreateEmpty($(MlirLocation loc)) } |]</span></span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span class="hs-comment">-- | Parse a module from a string. Returns 'Nothing' in case of parse failure.</span><span>
</span><span id="line-277"></span><span class="annot"><a href="MLIR.Native.html#parseModule"><span class="hs-identifier hs-type">parseModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="MLIR.Native.html#StringRef"><span class="hs-identifier hs-type">StringRef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span id="parseModule"><span class="annot"><span class="annottext">parseModule :: Context -&gt; StringRef -&gt; IO (Maybe Module)
</span><a href="MLIR.Native.html#parseModule"><span class="hs-identifier hs-var hs-var">parseModule</span></a></span></span><span> </span><span id="local-6989586621679450451"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679450451"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MLIR.Native.html#StringRef"><span class="hs-identifier hs-type">StringRef</span></a></span><span> </span><span id="local-6989586621679450450"><span class="annot"><span class="annottext">Ptr CChar
</span><a href="#local-6989586621679450450"><span class="hs-identifier hs-var">sPtr</span></a></span></span><span> </span><span id="local-6989586621679450449"><span class="annot"><span class="annottext">CSize
</span><a href="#local-6989586621679450449"><span class="hs-identifier hs-var">len</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; Maybe Module
forall a. Coercible a (Ptr ()) =&gt; a -&gt; Maybe a
</span><a href="MLIR.Native.FFI.html#nullable"><span class="hs-identifier hs-var">nullable</span></a></span><span> </span><span class="annot"><span class="annottext">(Module -&gt; Maybe Module) -&gt; IO Module -&gt; IO (Maybe Module)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span>
</span><span id="line-279"></span><span>  </span><span class="annot"><span class="">[C.exp| MlirModule {
    mlirModuleCreateParse($(MlirContext ctx),
                          (MlirStringRef){$(char* sPtr), $(size_t len)})
  } |]</span></span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span class="hs-comment">-- | Destroy all resources associated with a 'Module'.</span><span>
</span><span id="line-285"></span><span class="annot"><a href="MLIR.Native.html#destroyModule"><span class="hs-identifier hs-type">destroyModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span id="destroyModule"><span class="annot"><span class="annottext">destroyModule :: Module -&gt; IO ()
</span><a href="MLIR.Native.html#destroyModule"><span class="hs-identifier hs-var hs-var">destroyModule</span></a></span></span><span> </span><span id="local-6989586621679450447"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621679450447"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-287"></span><span>  </span><span class="annot"><span class="">[C.exp| void { mlirModuleDestroy($(MlirModule m)) } |]</span></span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span class="hs-comment">-- | Retrieve the block containg all module definitions.</span><span>
</span><span id="line-290"></span><span class="annot"><a href="MLIR.Native.html#getModuleBody"><span class="hs-identifier hs-type">getModuleBody</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span>
</span><span id="line-291"></span><span id="getModuleBody"><span class="annot"><span class="annottext">getModuleBody :: Module -&gt; IO Block
</span><a href="MLIR.Native.html#getModuleBody"><span class="hs-identifier hs-var hs-var">getModuleBody</span></a></span></span><span> </span><span id="local-6989586621679450445"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621679450445"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.exp| MlirBlock { mlirModuleGetBody($(MlirModule m)) } |]</span></span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span class="hs-comment">-- TODO(apaszke): Can this be pure?</span><span>
</span><span id="line-294"></span><span class="hs-comment">-- | Convert a module to an 'Operation'.</span><span>
</span><span id="line-295"></span><span class="annot"><a href="MLIR.Native.html#moduleAsOperation"><span class="hs-identifier hs-type">moduleAsOperation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Operation"><span class="hs-identifier hs-type">Operation</span></a></span><span>
</span><span id="line-296"></span><span id="moduleAsOperation"><span class="annot"><span class="annottext">moduleAsOperation :: Module -&gt; IO Operation
</span><a href="MLIR.Native.html#moduleAsOperation"><span class="hs-identifier hs-var hs-var">moduleAsOperation</span></a></span></span><span> </span><span id="local-6989586621679450443"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621679450443"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-297"></span><span>  </span><span class="annot"><span class="">[C.exp| MlirOperation { mlirModuleGetOperation($(MlirModule m)) } |]</span></span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span class="hs-comment">-- | Inverse of 'moduleAsOperation'. Returns 'Nothing' if the operation is not a</span><span>
</span><span id="line-300"></span><span class="hs-comment">-- builtin MLIR module operation.</span><span>
</span><span id="line-301"></span><span class="annot"><a href="MLIR.Native.html#moduleFromOperation"><span class="hs-identifier hs-type">moduleFromOperation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Operation"><span class="hs-identifier hs-type">Operation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-302"></span><span id="moduleFromOperation"><span class="annot"><span class="annottext">moduleFromOperation :: Operation -&gt; IO (Maybe Module)
</span><a href="MLIR.Native.html#moduleFromOperation"><span class="hs-identifier hs-var hs-var">moduleFromOperation</span></a></span></span><span> </span><span id="local-6989586621679450441"><span class="annot"><span class="annottext">Operation
</span><a href="#local-6989586621679450441"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-303"></span><span>  </span><span class="annot"><span class="annottext">Module -&gt; Maybe Module
forall a. Coercible a (Ptr ()) =&gt; a -&gt; Maybe a
</span><a href="MLIR.Native.FFI.html#nullable"><span class="hs-identifier hs-var">nullable</span></a></span><span> </span><span class="annot"><span class="annottext">(Module -&gt; Maybe Module) -&gt; IO Module -&gt; IO (Maybe Module)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="">[C.exp| MlirModule { mlirModuleFromOperation($(MlirOperation op)) } |]</span></span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span class="hs-comment">-- | Show the module using the MLIR printer.</span><span>
</span><span id="line-306"></span><span class="annot"><a href="MLIR.Native.html#showModule"><span class="hs-identifier hs-type">showModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">BS.ByteString</span></span><span>
</span><span id="line-307"></span><span id="showModule"><span class="annot"><span class="annottext">showModule :: Module -&gt; IO ByteString
</span><a href="MLIR.Native.html#showModule"><span class="hs-identifier hs-var hs-var">showModule</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; IO Operation
</span><a href="MLIR.Native.html#moduleAsOperation"><span class="hs-identifier hs-var">moduleAsOperation</span></a></span><span> </span><span class="annot"><span class="annottext">(Module -&gt; IO Operation)
-&gt; (Operation -&gt; IO ByteString) -&gt; Module -&gt; IO ByteString
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span> </span><span class="annot"><span class="annottext">Operation -&gt; IO ByteString
</span><a href="MLIR.Native.html#showOperation"><span class="hs-identifier hs-var">showOperation</span></a></span><span>
</span><span id="line-308"></span><span>
</span><span id="line-309"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-310"></span><span class="hs-comment">-- StringRef</span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span class="hs-keyword">data</span><span> </span><span id="StringRef"><span class="annot"><a href="MLIR.Native.html#StringRef"><span class="hs-identifier hs-var">StringRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="StringRef"><span class="annot"><a href="MLIR.Native.html#StringRef"><span class="hs-identifier hs-var">StringRef</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.CChar</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.CSize</span></span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span class="hs-comment">-- MLIR sometimes expects null-terminated StringRefs, so we can't use</span><span>
</span><span id="line-315"></span><span class="hs-comment">-- unsafeUseAsCStringLen, because ByteStrings are not guaranteed to have a terminator</span><span>
</span><span id="line-316"></span><span class="hs-comment">-- | Use a 'BS.ByteString' as a 'StringRef'. This is O(n) due to MLIR sometimes</span><span>
</span><span id="line-317"></span><span class="hs-comment">-- requiring the 'StringRef's to be null-terminated.</span><span>
</span><span id="line-318"></span><span id="local-6989586621679450438"><span class="annot"><a href="MLIR.Native.html#withStringRef"><span class="hs-identifier hs-type">withStringRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BS.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MLIR.Native.html#StringRef"><span class="hs-identifier hs-type">StringRef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679450438"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679450438"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-319"></span><span id="withStringRef"><span class="annot"><span class="annottext">withStringRef :: ByteString -&gt; (StringRef -&gt; IO a) -&gt; IO a
</span><a href="MLIR.Native.html#withStringRef"><span class="hs-identifier hs-var hs-var">withStringRef</span></a></span></span><span> </span><span id="local-6989586621679450437"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679450437"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679450436"><span class="annot"><span class="annottext">StringRef -&gt; IO a
</span><a href="#local-6989586621679450436"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; (Ptr CChar -&gt; IO a) -&gt; IO a
forall a. ByteString -&gt; (Ptr CChar -&gt; IO a) -&gt; IO a
</span><span class="hs-identifier hs-var">BS.useAsCString</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679450437"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679450434"><span class="annot"><span class="annottext">Ptr CChar
</span><a href="#local-6989586621679450434"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StringRef -&gt; IO a
</span><a href="#local-6989586621679450436"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(StringRef -&gt; IO a) -&gt; StringRef -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Ptr CChar -&gt; CSize -&gt; StringRef
</span><a href="MLIR.Native.html#StringRef"><span class="hs-identifier hs-var">StringRef</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr CChar
</span><a href="#local-6989586621679450434"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="annot"><span class="annottext">(CSize -&gt; StringRef) -&gt; CSize -&gt; StringRef
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; CSize
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; CSize) -&gt; Int -&gt; CSize
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">BS.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679450437"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span class="hs-comment">-- | Copy a 'StringRef' as a 'BS.ByteString'. This is an O(n) operation.</span><span>
</span><span id="line-322"></span><span class="annot"><a href="MLIR.Native.html#peekStringRef"><span class="hs-identifier hs-type">peekStringRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MLIR.Native.html#StringRef"><span class="hs-identifier hs-type">StringRef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">BS.ByteString</span></span><span>
</span><span id="line-323"></span><span id="peekStringRef"><span class="annot"><span class="annottext">peekStringRef :: StringRef -&gt; IO ByteString
</span><a href="MLIR.Native.html#peekStringRef"><span class="hs-identifier hs-var hs-var">peekStringRef</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MLIR.Native.html#StringRef"><span class="hs-identifier hs-type">StringRef</span></a></span><span> </span><span id="local-6989586621679450431"><span class="annot"><span class="annottext">Ptr CChar
</span><a href="#local-6989586621679450431"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621679450430"><span class="annot"><span class="annottext">CSize
</span><a href="#local-6989586621679450430"><span class="hs-identifier hs-var">size</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CStringLen -&gt; IO ByteString
</span><span class="hs-identifier hs-var">BS.packCStringLen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr CChar
</span><a href="#local-6989586621679450431"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CSize -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">CSize
</span><a href="#local-6989586621679450430"><span class="hs-identifier hs-var">size</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-324"></span><span>
</span><span id="line-325"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-326"></span><span class="hs-comment">-- Identifier</span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span class="hs-comment">-- | View an identifier as a 'StringRef'. The result is valid for as long as the</span><span>
</span><span id="line-329"></span><span class="hs-comment">-- 'Context' managing the identifier.</span><span>
</span><span id="line-330"></span><span class="annot"><a href="MLIR.Native.html#identifierString"><span class="hs-identifier hs-type">identifierString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="MLIR.Native.html#StringRef"><span class="hs-identifier hs-type">StringRef</span></a></span><span>
</span><span id="line-331"></span><span id="identifierString"><span class="annot"><span class="annottext">identifierString :: Identifier -&gt; IO StringRef
</span><a href="MLIR.Native.html#identifierString"><span class="hs-identifier hs-var hs-var">identifierString</span></a></span></span><span> </span><span id="local-6989586621679450428"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621679450428"><span class="hs-identifier hs-var">ident</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContT StringRef IO StringRef -&gt; IO StringRef
forall (m :: * -&gt; *) r. Monad m =&gt; ContT r m r -&gt; m r
</span><span class="hs-identifier hs-var">evalContT</span></span><span> </span><span class="annot"><span class="annottext">(ContT StringRef IO StringRef -&gt; IO StringRef)
-&gt; ContT StringRef IO StringRef -&gt; IO StringRef
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-332"></span><span>  </span><span id="local-6989586621679450426"><span class="annot"><span class="annottext">Ptr (Ptr CChar)
</span><a href="#local-6989586621679450426"><span class="hs-identifier hs-var">namePtrPtr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Ptr (Ptr CChar) -&gt; IO StringRef) -&gt; IO StringRef)
-&gt; ContT StringRef IO (Ptr (Ptr CChar))
forall k (r :: k) (m :: k -&gt; *) a.
((a -&gt; m r) -&gt; m r) -&gt; ContT r m a
</span><span class="hs-identifier hs-var">ContT</span></span><span> </span><span class="annot"><span class="annottext">(Ptr (Ptr CChar) -&gt; IO StringRef) -&gt; IO StringRef
forall a b. Storable a =&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">alloca</span></span><span>
</span><span id="line-333"></span><span>  </span><span id="local-6989586621679450423"><span class="annot"><span class="annottext">Ptr CSize
</span><a href="#local-6989586621679450423"><span class="hs-identifier hs-var">sizePtr</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Ptr CSize -&gt; IO StringRef) -&gt; IO StringRef)
-&gt; ContT StringRef IO (Ptr CSize)
forall k (r :: k) (m :: k -&gt; *) a.
((a -&gt; m r) -&gt; m r) -&gt; ContT r m a
</span><span class="hs-identifier hs-var">ContT</span></span><span> </span><span class="annot"><span class="annottext">(Ptr CSize -&gt; IO StringRef) -&gt; IO StringRef
forall a b. Storable a =&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">alloca</span></span><span>
</span><span id="line-334"></span><span>  </span><span class="annot"><span class="annottext">IO StringRef -&gt; ContT StringRef IO StringRef
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO StringRef -&gt; ContT StringRef IO StringRef)
-&gt; IO StringRef -&gt; ContT StringRef IO StringRef
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-335"></span><span>    </span><span class="annot"><span class="">[C.block| void {
      MlirStringRef identStr = mlirIdentifierStr($(MlirIdentifier ident));
      *$(const char** namePtrPtr) = identStr.data;
      *$(size_t* sizePtr) = identStr.length;
    } |]</span></span><span>
</span><span id="line-340"></span><span>    </span><span class="annot"><span class="annottext">Ptr CChar -&gt; CSize -&gt; StringRef
</span><a href="MLIR.Native.html#StringRef"><span class="hs-identifier hs-var">StringRef</span></a></span><span> </span><span class="annot"><span class="annottext">(Ptr CChar -&gt; CSize -&gt; StringRef)
-&gt; IO (Ptr CChar) -&gt; IO (CSize -&gt; StringRef)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr CChar) -&gt; IO (Ptr CChar)
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr CChar)
</span><a href="#local-6989586621679450426"><span class="hs-identifier hs-var">namePtrPtr</span></a></span><span> </span><span class="annot"><span class="annottext">IO (CSize -&gt; StringRef) -&gt; IO CSize -&gt; IO StringRef
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Ptr CSize -&gt; IO CSize
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="annot"><span class="annottext">Ptr CSize
</span><a href="#local-6989586621679450423"><span class="hs-identifier hs-var">sizePtr</span></a></span><span>
</span><span id="line-341"></span><span>
</span><span id="line-342"></span><span class="hs-comment">-- | Create an identifier from a 'StringRef'.</span><span>
</span><span id="line-343"></span><span class="annot"><a href="MLIR.Native.html#createIdentifier"><span class="hs-identifier hs-type">createIdentifier</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="MLIR.Native.html#StringRef"><span class="hs-identifier hs-type">StringRef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span>
</span><span id="line-344"></span><span id="createIdentifier"><span class="annot"><span class="annottext">createIdentifier :: Context -&gt; StringRef -&gt; IO Identifier
</span><a href="MLIR.Native.html#createIdentifier"><span class="hs-identifier hs-var hs-var">createIdentifier</span></a></span></span><span> </span><span id="local-6989586621679450419"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679450419"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MLIR.Native.html#StringRef"><span class="hs-identifier hs-type">StringRef</span></a></span><span> </span><span id="local-6989586621679450418"><span class="annot"><span class="annottext">Ptr CChar
</span><a href="#local-6989586621679450418"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621679450417"><span class="annot"><span class="annottext">CSize
</span><a href="#local-6989586621679450417"><span class="hs-identifier hs-var">size</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-345"></span><span>  </span><span class="annot"><span class="">[C.exp| MlirIdentifier {
    mlirIdentifierGet($(MlirContext ctx), (MlirStringRef){$(char* ref), $(size_t size)})
  } |]</span></span><span>
</span><span id="line-348"></span><span>
</span><span id="line-349"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-350"></span><span class="hs-comment">-- Utilities</span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span class="annot"><a href="MLIR.Native.html#showSomething"><span class="hs-identifier hs-type">showSomething</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">BS.ByteString</span></span><span>
</span><span id="line-353"></span><span id="showSomething"><span class="annot"><span class="annottext">showSomething :: (Ptr () -&gt; IO ()) -&gt; IO ByteString
</span><a href="MLIR.Native.html#showSomething"><span class="hs-identifier hs-var hs-var">showSomething</span></a></span></span><span> </span><span id="local-6989586621679450415"><span class="annot"><span class="annottext">Ptr () -&gt; IO ()
</span><a href="#local-6989586621679450415"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-354"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; (Ptr (Ptr ()) -&gt; IO ByteString) -&gt; IO ByteString
forall a b. Storable a =&gt; Int -&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">allocaArray</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679450413"><span class="annot"><span class="annottext">Ptr (Ptr ())
</span><a href="#local-6989586621679450413"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-355"></span><span>    </span><span class="annot"><span class="annottext">(Ptr CSize -&gt; IO ByteString) -&gt; IO ByteString
forall a b. Storable a =&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">alloca</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">C.CSize</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679450412"><span class="annot"><span class="annottext">Ptr CSize
</span><a href="#local-6989586621679450412"><span class="hs-identifier hs-var">sizePtr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-356"></span><span>      </span><span class="annot"><span class="annottext">Ptr CSize -&gt; CSize -&gt; IO ()
forall a. Storable a =&gt; Ptr a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">poke</span></span><span> </span><span class="annot"><span class="annottext">Ptr CSize
</span><a href="#local-6989586621679450412"><span class="hs-identifier hs-var">sizePtr</span></a></span><span> </span><span class="annot"><span class="annottext">CSize
</span><span class="hs-number">0</span></span><span>
</span><span id="line-357"></span><span>      </span><span class="annot"><span class="annottext">Ptr (Ptr ()) -&gt; Int -&gt; Ptr () -&gt; IO ()
forall a. Storable a =&gt; Ptr a -&gt; Int -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">pokeElemOff</span></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr ())
</span><a href="#local-6989586621679450413"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Ptr ()
forall a. Ptr a
</span><span class="hs-identifier hs-var">nullPtr</span></span><span>
</span><span id="line-358"></span><span>      </span><span class="annot"><span class="annottext">Ptr (Ptr ()) -&gt; Int -&gt; Ptr () -&gt; IO ()
forall a. Storable a =&gt; Ptr a -&gt; Int -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">pokeElemOff</span></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr ())
</span><a href="#local-6989586621679450413"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(Ptr () -&gt; IO ()) -&gt; Ptr () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Ptr CSize -&gt; Ptr ()
forall a b. Ptr a -&gt; Ptr b
</span><span class="hs-identifier hs-var">castPtr</span></span><span> </span><span class="annot"><span class="annottext">Ptr CSize
</span><a href="#local-6989586621679450412"><span class="hs-identifier hs-var">sizePtr</span></a></span><span>
</span><span id="line-359"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679450407"><span class="annot"><span class="annottext">ctxFlat :: Ptr ()
</span><a href="#local-6989586621679450407"><span class="hs-identifier hs-var hs-var">ctxFlat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr (Ptr ()) -&gt; Ptr ()
forall a b. Ptr a -&gt; Ptr b
</span><span class="hs-identifier hs-var">castPtr</span></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr ())
</span><a href="#local-6989586621679450413"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>      </span><span class="annot"><span class="annottext">Ptr () -&gt; IO ()
</span><a href="#local-6989586621679450415"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr ()
</span><a href="#local-6989586621679450407"><span class="hs-identifier hs-var">ctxFlat</span></a></span><span>
</span><span id="line-361"></span><span>      </span><span id="local-6989586621679450406"><span class="annot"><span class="annottext">Ptr CChar
</span><a href="#local-6989586621679450406"><span class="hs-identifier hs-var">dataPtr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ptr () -&gt; Ptr CChar
forall a b. Ptr a -&gt; Ptr b
</span><span class="hs-identifier hs-var">castPtr</span></span><span> </span><span class="annot"><span class="annottext">(Ptr () -&gt; Ptr CChar) -&gt; IO (Ptr ()) -&gt; IO (Ptr CChar)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr ()) -&gt; IO (Ptr ())
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr ())
</span><a href="#local-6989586621679450413"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-362"></span><span>      </span><span id="local-6989586621679450405"><span class="annot"><span class="annottext">CSize
</span><a href="#local-6989586621679450405"><span class="hs-identifier hs-var">size</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ptr CSize -&gt; IO CSize
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="annot"><span class="annottext">Ptr CSize
</span><a href="#local-6989586621679450412"><span class="hs-identifier hs-var">sizePtr</span></a></span><span>
</span><span id="line-363"></span><span>      </span><span id="local-6989586621679450404"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679450404"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StringRef -&gt; IO ByteString
</span><a href="MLIR.Native.html#peekStringRef"><span class="hs-identifier hs-var">peekStringRef</span></a></span><span> </span><span class="annot"><span class="annottext">(StringRef -&gt; IO ByteString) -&gt; StringRef -&gt; IO ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Ptr CChar -&gt; CSize -&gt; StringRef
</span><a href="MLIR.Native.html#StringRef"><span class="hs-identifier hs-var">StringRef</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr CChar
</span><a href="#local-6989586621679450406"><span class="hs-identifier hs-var">dataPtr</span></a></span><span> </span><span class="annot"><span class="annottext">CSize
</span><a href="#local-6989586621679450405"><span class="hs-identifier hs-var">size</span></a></span><span>
</span><span id="line-364"></span><span>      </span><span class="annot"><span class="annottext">Ptr CChar -&gt; IO ()
forall a. Ptr a -&gt; IO ()
</span><span class="hs-identifier hs-var">free</span></span><span> </span><span class="annot"><span class="annottext">Ptr CChar
</span><a href="#local-6989586621679450406"><span class="hs-identifier hs-var">dataPtr</span></a></span><span>
</span><span id="line-365"></span><span>      </span><span class="annot"><span class="annottext">ByteString -&gt; IO ByteString
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679450404"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span class="hs-comment">-- | Unroll using a function that is equivalent to &quot;get next&quot; inside IO.</span><span>
</span><span id="line-368"></span><span id="local-6989586621679450592"><span class="annot"><a href="MLIR.Native.html#unrollIOMaybe"><span class="hs-identifier hs-type">unrollIOMaybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679450592"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679450592"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679450592"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679450592"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-369"></span><span id="unrollIOMaybe"><span class="annot"><span class="annottext">unrollIOMaybe :: (a -&gt; IO (Maybe a)) -&gt; IO (Maybe a) -&gt; IO [a]
</span><a href="MLIR.Native.html#unrollIOMaybe"><span class="hs-identifier hs-var hs-var">unrollIOMaybe</span></a></span></span><span> </span><span id="local-6989586621679450402"><span class="annot"><span class="annottext">a -&gt; IO (Maybe a)
</span><a href="#local-6989586621679450402"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span id="local-6989586621679450401"><span class="annot"><span class="annottext">IO (Maybe a)
</span><a href="#local-6989586621679450401"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-370"></span><span>  </span><span id="local-6989586621679450400"><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621679450400"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Maybe a)
</span><a href="#local-6989586621679450401"><span class="hs-identifier hs-var">z</span></a></span><span>
</span><span id="line-371"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621679450400"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-372"></span><span>      </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; IO [a]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-373"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679450399"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679450399"><span class="hs-identifier hs-var">x'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679450399"><span class="hs-identifier hs-var">x'</span></a></span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([a] -&gt; [a]) -&gt; IO [a] -&gt; IO [a]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; IO (Maybe a)) -&gt; IO (Maybe a) -&gt; IO [a]
forall a. (a -&gt; IO (Maybe a)) -&gt; IO (Maybe a) -&gt; IO [a]
</span><a href="MLIR.Native.html#unrollIOMaybe"><span class="hs-identifier hs-var">unrollIOMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; IO (Maybe a)
</span><a href="#local-6989586621679450402"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; IO (Maybe a)
</span><a href="#local-6989586621679450402"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679450399"><span class="hs-identifier hs-var">x'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>
</span><span id="line-375"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-376"></span><span class="hs-comment">-- Debugging utilities</span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span class="hs-comment">-- | Enable or disable debug logging in MLIR.</span><span>
</span><span id="line-379"></span><span class="annot"><a href="MLIR.Native.html#setDebugMode"><span class="hs-identifier hs-type">setDebugMode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-380"></span><span id="setDebugMode"><span class="annot"><span class="annottext">setDebugMode :: Bool -&gt; IO ()
</span><a href="MLIR.Native.html#setDebugMode"><span class="hs-identifier hs-var hs-var">setDebugMode</span></a></span></span><span> </span><span id="local-6989586621679450398"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679450398"><span class="hs-identifier hs-var">enable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-381"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679450397"><span class="annot"><span class="annottext">nativeEnable :: CBool
</span><a href="#local-6989586621679450397"><span class="hs-identifier hs-var hs-var">nativeEnable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679450398"><span class="hs-identifier hs-var">enable</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">CBool
</span><span class="hs-number">1</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">CBool
</span><span class="hs-number">0</span></span><span>
</span><span id="line-382"></span><span>  </span><span class="annot"><span class="">[C.exp| void { mlirEnableGlobalDebug($(bool nativeEnable)) } |]</span></span><span>
</span><span id="line-383"></span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span class="hs-comment">-- | A class for native objects that can be dumped to standard error output.</span><span>
</span><span id="line-386"></span><span class="hs-keyword">class</span><span> </span><span id="HasDump"><span class="annot"><a href="MLIR.Native.html#HasDump"><span class="hs-identifier hs-var">HasDump</span></a></span></span><span> </span><span id="local-6989586621679450552"><span class="annot"><a href="#local-6989586621679450552"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-387"></span><span>  </span><span class="hs-comment">-- | Display the value in the standard error output.</span><span>
</span><span id="line-388"></span><span>  </span><span id="dump"><span class="annot"><a href="MLIR.Native.html#dump"><span class="hs-identifier hs-type">dump</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679450552"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="MLIR.Native.html#HasDump"><span class="hs-identifier hs-type">HasDump</span></a></span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Operation"><span class="hs-identifier hs-type">Operation</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-391"></span><span>  </span><span id="local-6989586621679450392"><span class="annot"><span class="annottext">dump :: Operation -&gt; IO ()
</span><a href="#local-6989586621679450392"><span class="hs-identifier hs-var hs-var hs-var hs-var">dump</span></a></span></span><span> </span><span id="local-6989586621679450391"><span class="annot"><span class="annottext">Operation
</span><a href="#local-6989586621679450391"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.exp| void { mlirOperationDump($(MlirOperation op)) } |]</span></span><span>
</span><span id="line-392"></span><span>
</span><span id="line-393"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="MLIR.Native.html#HasDump"><span class="hs-identifier hs-type">HasDump</span></a></span><span> </span><span class="annot"><a href="MLIR.Native.FFI.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-394"></span><span>  </span><span id="local-6989586621679450388"><span class="annot"><span class="annottext">dump :: Module -&gt; IO ()
</span><a href="#local-6989586621679450388"><span class="hs-identifier hs-var hs-var hs-var hs-var">dump</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; IO Operation
</span><a href="MLIR.Native.html#moduleAsOperation"><span class="hs-identifier hs-var">moduleAsOperation</span></a></span><span> </span><span class="annot"><span class="annottext">(Module -&gt; IO Operation) -&gt; (Operation -&gt; IO ()) -&gt; Module -&gt; IO ()
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span> </span><span class="annot"><span class="annottext">Operation -&gt; IO ()
forall a. HasDump a =&gt; a -&gt; IO ()
</span><a href="MLIR.Native.html#dump"><span class="hs-identifier hs-var">dump</span></a></span><span>
</span><span id="line-395"></span></pre></body></html>